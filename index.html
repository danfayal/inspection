<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
<style type="text/css">
	.button1{
    width: 350px;
    text-align: center;
    padding: 15px 20px;
    border: 1px solid #eee;
    border-radius: 6px;
    background-color: #FCC302;
    font-size: 18px;
}

	.button2{
    width: 350px;
    text-align: center;
    padding: 21px 26px;
    border: 1px solid #eee;
    border-radius: 6px;
    background-color: #FCC302;
    font-size: 18px;
}

</style>
		
	
    <title> Vistoria Conquiste Proteção Veicular</title>
</head>

<body>
   

	 <div>
	<video id="video" width="480" height="400" autoplay></video>
		   </div>
		  <div>
        <canvas id="canvas" width="480" height="400"></canvas> 
		  </div>
			  <div>
	<button class="button1"  id="start-camera" >Habilitar Câmera</button><br>
           </div>
				  <div>
				  <button class="button2"  id="click-photo">Tire a foto</button><br>
		                              </div>
</body>
<script type="text/javascript">
 let d = new Date();
    let date = d.getDate();
    let year = d.getFullYear() + ",";
    let month = d.getMonth();
	let horas = d.getHours();
let minutos = d.getMinutes();
let segundos = d.getSeconds();
let hhmmmss =  " " +[horas, minutos, segundos].join(':');
	
    let monthArr = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro","Dezembro"];
    month = monthArr[month];

   let camera_button = document.querySelector("#start-camera");
let video = document.querySelector("#video");
let click_button = document.querySelector("#click-photo");
let canvas = document.querySelector("#canvas");
let ctx = canvas.getContext("2d") ;
let link = document.createElement('a');	

    
let img = new Image();


camera_button.addEventListener('click', async function() {
   	let stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });

	video.srcObject = stream;

});

click_button.addEventListener('click', function() {
   	canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
   	let image_data_url = canvas.toDataURL('image/jpeg');

   	// data url of the image
   	console.log(image_data_url);
		
img.onload = function(){
    ctx.drawImage(img, 35,175, 60,60);
};


img.src = "logo.png";

		ctx.font = "19px Arial";
ctx.fillText(date+" "+month+", "+year +hhmmmss + " ", 10, 50); 
	  link.innerHTML = 'baixar para compartilhar';
	document.body.appendChild(link);
	alert("clique no link e baixe a foto");
});


	
  
link.addEventListener('click', function(ev) {
	
    link.href = canvas.toDataURL();
   link.download = "conquistevistoria.png";
}, false);

	
	
	
	
</script>

</html>
